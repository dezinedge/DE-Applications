<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="assets/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/roboto/font-roboto.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquerymobile.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquerymobile.nativedroid.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquerymobile.nativedroid.light.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquerymobile.nativedroid.color.green.css" rel="stylesheet"
        type="text/css" />
    <script src="assets/js/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="assets/js/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>
    <script src="assets/js/nativedroid.script.js" type="text/javascript"></script>
    <script src="phonegap.js" type="text/javascript"></script>
    <script type="text/javascript">
        var pictureSource;   // picture source
        var destinationType; // sets the format of returned value
        var imageDataSrv;
        
        document.addEventListener("deviceready", onDeviceReady, false);

        $(function(){
            FillDropdown();
        });
        
        function onDeviceReady() {
            pictureSource=navigator.camera.PictureSourceType;
            destinationType=navigator.camera.DestinationType;
            
        }
        
        function AddDatabase()
        {
            var ddlTypes = document.getElementById('ddlTypes');
            var elLatitude = document.getElementById('txtLatitude');
            var elLongitude = document.getElementById('txtLongitude');
            var txtHosipital = document.getElementById('txtHosipital');
            var txtAddress1 = document.getElementById('txtAddress1');
            var txtAddress2 = document.getElementById('txtAddress2');
            var DbImage = document.getElementById('imgHospital');  
               
            $.ajax({
               	url: 'http://aurangabadcitycare.com/index.php',
                type: 'POST',
                data: { pDbName:txtHosipital.value, pDbAddress1:txtAddress1.value, pDbAddress2:txtAddress2.value,
                    pLatitude:elLatitude.value,pLongitude:elLongitude.value ,pDbImage:DbImage.src,pDbTypeId:ddlTypes.value },
                datatype: 'application/json',
                success: function(msg) {
                    alert('Data has been stored successfully!');
                    elLatitude.value ='';
                    elLongitude.value ='';
                    txtHosipital.value ='';
                    txtAddress1.value ='';
                    txtAddress2.value ='';
                    var elCameraPic = document.getElementById('imgHospital');
                    elCameraPic.style.width = '120px';
                    elCameraPic.src = 'assets/img/camera.png';
                    ddlTypes.value = -1;
                },
                error: function() { alert('Failed!'); },
        	    crossDomain: true
        	});
        }
        
        function FillDropdown()
        {
          $.ajax({
           	url: 'http://aurangabadcitycare.com/dbtypes.php',
            type: 'POST',
            data: {},
            datatype: 'application/json',
            success: function(msg) { 
               var obj = jQuery.parseJSON(msg);
               var ddldata = '';  
               $.each(obj,function(idx,db){
                    if(idx == 0){
                        ddldata += '<option value="'+db.data.DbTypeId+'" selected="selected">'+db.data.DbType+'</option>';
                    }
                    else
                    {
                        ddldata += '<option value="'+db.data.DbTypeId+'">'+db.data.DbType+'</option>';
                    }
               }); 
               $("#ddlTypes").html(ddldata);
            },
            error: function() { 
               alert('error');     
            },
        	crossDomain: true
        	});
        }
        
        function GetLocation()
        {
            navigator.geolocation.getCurrentPosition(onSuccess, onError,{maximumAge: 300000, timeout:10000, enableHighAccuracy : true});   
        }
        
        function onSuccess(position) {
            var elLatitude = document.getElementById('txtLatitude');
            var elLongitude = document.getElementById('txtLongitude');
            elLatitude.value = position.coords.latitude;
            elLongitude.value = position.coords.longitude;
        }
        
        function onError(){alert('error occured');}
        
        function capturePhoto(){
            //navigator.camera.getPicture(onPhotoURISuccess,null,{sourceType:1,quality:60,destinationType: destinationType.FILE_URI });
            navigator.camera.getPicture(onPhotoDataSuccess,null,{sourceType:1,quality:60 });
        }
        
        function onPhotoDataSuccess(imageData)
        {
            imageDataSrv = imageData;
            alert('image uploaded success');
            var elCameraPic = document.getElementById('imgHospital');
            elCameraPic.style.display = 'block';
            elCameraPic.src = "data:image/jpeg;base64," + imageData;
        }
        
        function onPhotoURISuccess(imageURI){
            alert('image uploaded success');
            var elCameraPic = document.getElementById('imgHospital');
            elCameraPic.style.display = 'block';
            elCameraPic.src = imageURI;
        }
        
        function onSubmit()
        {
            alert('Data has been stored successfully!');
            var elLatitude = document.getElementById('txtLatitude');
            var elLongitude = document.getElementById('txtLongitude');
            var txtHosipital = document.getElementById('txtHosipital');
            var txtAddress1 = document.getElementById('txtAddress1');
            var txtAddress2 = document.getElementById('txtAddress2');
            elLatitude.value ='';
            elLongitude.value ='';
            txtHosipital.value ='';
            txtAddress1.value ='';
            txtAddress2.value ='';
            var elCameraPic = document.getElementById('imgHospital');
            elCameraPic.style.width = '120px';
            elCameraPic.src = 'assets/img/camera.png';
        }
    </script>
</head>
<body>
    <div data-role="page" data-theme='b' id="pgHome">
        <div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
            <h1>
                CC - Registeration</h1>
            <a href="#pgHome"><i class='icon-windows'></i></a>
        </div>
        <div data-role="content">
            <form>
                <ul data-role="listview" data-inset="true">
                    
                    <img id="imgHospital" id="imgHospital" src="assets/img/camera.png" style="width: 120px;" onclick="capturePhoto();" />
                     
                     <li data-role="fieldcontain">
                    <select id="ddlTypes" name="ddlTypes" data-native-menu="true"></select>
                    </li>
                    
                    <li data-role="fieldcontain">
                    <input type="text" name="txtHosipital" id="txtHosipital" data-clear-btn="true" placeholder="Type hospital name here..." 
                    style="width: 100%;" />
                    </li>
                     <li data-role="fieldcontain">
                        <textarea cols="40" rows="8" name="txtAddress1" id="txtAddress1" placeholder="Type Address 1 here..." style="width: 100%;"></textarea>
                    </li>
                     <li data-role="fieldcontain">
                        <textarea cols="40" rows="8" name="txtAddress2" id="txtAddress2" placeholder="Type Address 2 here..." style="width: 100%;"></textarea>
                    </li>
                    <li data-role="fieldcontain">
                        <input type="button" onclick="GetLocation();" name="btnGetLocation" id="btnGetLocation" value="Get Location" data-clear-btn="true" title="Type hospital name here..."/>
                    </li>
                    <li data-role="fieldcontain">
                    <input type="text" disabled="disabled" name="txtLatitude" id="txtLatitude" data-clear-btn="true" placeholder="Click get location to get Latitude" 
                    style="width: 100%;" />
                    </li>
                    <li data-role="fieldcontain">
                    <input type="text" disabled="disabled" name="txtLongitude" id="txtLongitude" data-clear-btn="true" placeholder="Click get location to get Longitude" 
                    style="width: 100%;" />
                    </li>
                    <li data-role="fieldcontain">
                        <input type="button" name="btnSave" id="btnSave" value="Save" data-clear-btn="true" onclick="AddDatabase();"/>
                    </li>
                </ul>
            </form>
        </div>
        <div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme='b'>
            <div data-position="fixed" data-tap-toggle="false" data-role="footer" data-tap-toggle="false"
                data-theme='b'>
                <div data-role="navbar">
                    <ul>
                        <li><a href="index.html" data-icon="home" data-ajax="false">Home</a></li>
                        <li><a href="#dvAbout" data-icon="info">About</a></li>
                        <li><a href="#" data-icon="phone">Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
